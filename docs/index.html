<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Change the description wrt project -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- You can add your own fonts from fonts.google.com -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins&display=swap"
      rel="stylesheet"
    />

    <!-- Default Script tags -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="./public/js/index.js"></script>

    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>

    <!-- Replace the title name -->
    <title>Alephsyslab Covid19 Documentation</title>
  </head>
  <body
    style="font-family: 'Poppins', sans-serif"
    class="dark:bg-slate-900 bg-white dark:text-white"
  >
    <!-- Header start here -->
    <header class="w-full p-3 border-b dark:border-b flex">
      <nav
        class="w-full flex flex-col lg:flex-row md:flex-row sm:flex-row items-start lg:item-center md:item-center sm:item-center lg:justify-between md:justify-between sm:justify-between justify-start"
      >
        <ul>
          <li class="font-mono text-xl">Alephsyslab Covid19 Documentation</li>
        </ul>
        <ul id="header-nav" class="mr-6 sm:flex md:flex lg:flex hidden">
          <li
            class="mr-5 mb-3 mt-5 sm:mb-0 sm:mt-0 md:mb-0 md:mt-0 lg:mb-0 lg:mt-0"
          >
            <a href="./index.html">Home</a>
          </li>
          <div>
            <ul class="flex">
              <!-- Change the href link to your respective social media accounts-->
              <li class="mr-5 hidden dark:flex">
                <p onclick="lightmode()">
                  <img src="./public/svgs/sun-dark.svg" alt="sun Link" />
                </p>
              </li>
              <li class="mr-5 flex dark:hidden">
                <a href="https://github.com/dandybit/alephsyslab.github.io"
                  ><img src="./public/svgs/github.svg" alt="GitHub Link"
                /></a>
              </li>
              <li class="mr-5 hidden dark:flex">
                <a href="https://github.com/dandybit/alephsyslab.github.io"
                  ><img src="./public/svgs/github-dark.svg" alt="GitHub Link"
                /></a>
              </li>
              <li class="mr-5 flex dark:hidden">
                <a href="https://twitter.com/_alephsys_"
                  ><img src="./public/svgs/twitter.svg" alt="Twitter Link"
                /></a>
              </li>
              <li class="mr-5 hidden dark:flex">
                <a href="https://twitter.com/_alephsys_"
                  ><img src="./public/svgs/twitter-dark.svg" alt="Twitter Link"
                /></a>
              </li>
            </ul>
          </div>
        </ul>
      </nav>

      <div class="sm:hidden flex" onclick="OnclickOpenMenu()" id="open-menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div class="hidden" onclick="OnclickCloseMenu()" id="close-menu">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </div>
    </header>
    <!-- Header ends here -->

    <div class="flex flex-col md:flex-row lg:flex-row">
      <!-- Side menu starts here -->
      <nav
        class="flex ml-10 mt-7 md:fixed lg:fixed"
        data-spy="affix"
        data-offset-top="300"
        data-offset-bottom="200"
        role="navigation"
      >
        <ul class="nav">
          <li class="font-medium"><a href="#link1">Introduction</a></li>
          <li class="font-medium">
            <a href="#link2">Django and Nginx</a>
            <ul class="nav">
              <li
                class="text-[#111] dark:text-slate-300 pl-[20px] font-[400] border-l-[2px]"
              >
                <a href="#link2_1">Request</a>
              </li>
              <li
                class="text-[#111] dark:text-slate-300 pl-[20px] font-[400] border-l-[2px]"
              >
                <a href="#link2_2">Reception</a>
              </li>
              <li
                class="text-[#111] dark:text-slate-300 pl-[20px] font-[400] border-l-[2px]"
              >
                <a href="#link2_3">Server-Side Cache</a>
              </li>
            </ul>
          </li>
           <li class="font-medium">
            <a href="#link3">Julia Model</a>
            <ul class="nav">
              <li
                class="text-[#111] dark:text-slate-300 pl-[20px] font-[400] border-l-[2px]"
              >
                <a href="#link3_1">Julia API Server</a>
              </li>
              <li
                class="text-[#111] dark:text-slate-300 pl-[20px] font-[400] border-l-[2px]"
              >
                <a href="#link3_2">Julia Model</a>
              </li>
            </ul>
          </li>



        </ul>
      </nav>
      <!-- Side Menu ends here -->

      <div class="pl-5 md:pl-[250px] lg:pl-[250px]">
        <!-- Link1 start -->
        <section id="link1">
          <div class="h-full mt-10">
            <p class="font-normal text-2xl">Introduction</p>
            <p class="leading-0 w-3/4">
                <br>
                Covid19 simulator is an implementation of the <a href="https://github.com/jtmatamalas/MMCAcovid19.jl">MMCAcovid19.jl</a> model.
                The model runs on a cloud server alongside the web server Nginx. As a framework for the web, Django has been used.
                Furthermore, all simulations are stored on the server using Mongo as DB engine.
            </p>
          </div>
        </section>
        <!-- Link1 end -->

        <!-- Link2 Start -->
        <section id="link2">
          <div class="h-full mt-5">
            <p class="font-normal text-2xl">Django and Nginx</p>
            <p class="leading-0 w-3/4">
                <br>
                Nginx has been used as a web server together with the Django framework to facilitate implementation.
                The client through the web requests the simulation from the server through an API for simulations.
                <br>
            </p>
          </div>
          <section id="link2_1" class="border-l-[2px]">
            <div class="h-full mt-3 ml-5">
              <p class="font-normal text-xl">Request</p>
              <p class="text-sm pb-4">
                  The request is made through a request to the API. We use ajax to make the requests and we use a dictionary
                  as the request content. The content will have the options entered by the user.
              </p>
                <xmp>
                     $.ajax({
                        type: "GET",
                        url: "api/simulation",
                        data: {
                            "timesteps": document.getElementById('timesteps_id').value,
                            "lockdown_info": JSON.stringify(lockdown_info),
                            "patient_zero": document.getElementById('patient_zero_id').value,
                    },
                </xmp>
            </div>
          </section>
          <section id="link2_2" class="border-l-[2px]">
            <div class="h-full mt-5 ml-5">
              <p class="font-normal text-xl">Reception</p>
              <p class="text-sm pb-4">
                  The response from the server is a JSON. This JSON contains the data for the map and graphics that are displayed on the web.
                  The information for the graphs is found in population_params. The data is used to display the graphs
                  through the plotly framework for its generation.
              </p>
              <xmp>
                  {
                    "simulation_id": "12651813574619295644",
                    "date_run": "2022-06-23",
                    "model_id": "MMCAcovid19-0.1.0",
                    "params": {
                        "start_date": "2020-03-01",
                        "end_date": "2020-09-16",
                        "num_timesteps": 200,
                        "population_params": {...},
                    "hash_id": "6be49b21896b862f413bd9f8201cb346"
                  }
              </xmp>
            </div>
          </section>
          <section id="link2_3" class="border-l-[2px]">
            <div class="h-full mt-5 ml-5">
              <p class="font-normal text-xl">Server-Side Cache</p>
              <p class="text-sm pb-4">
                  The model takes between 30-60 secs to generate the simulation. In order to accelerate the requests,
                  the server has a cache system. The system stores the simulation generated by the users in a Mongo database.
                  Each simulation has a unique ID to identify them. The ID is obtained through the JSON file generated
                  by the GET request using MD5. The server checks if the ID exists, if it exists,
                  the database is accessed and the simulation is returned, otherwise the model is called.
              </p>
              <xmp>
                  class SimulationList(APIView):

                    def get(self, request, hash=None, format=None):
                        json_request = request.GET.dict()  # Transform GET REQUEST into Python Dict.
                        check_hash = hashlib.md5(str(json_request).encode('utf-8')).hexdigest() # Generate Dict HASH MD5

                        check_simulation = db.find_one({'hash_id': str(check_hash)}) # Check simulation hash.

                        # If simulation already exist in MongoDB.
                        if check_simulation:
                            del (check_simulation["_id"]) # Remove _id from Dict
                            return Response(check_simulation) # Return Mongo Request.
                        else:
                            json_simulation = requests.post(url_api_julia_simulation, json=json_request).json()
                            json_simulation = json.loads(json_simulation)
                            json_simulation = preprocess_julia_json(json_simulation) # Call Julia Model
                            json_simulation["hash_id"] = str(check_hash) # Add hash Dict
                            json_simulation["simulation_id"] = str(json_simulation["simulation_id"])
                            json_file = json.dumps(json_simulation)
                            json_file = json.loads(json_file)
                            db.insert_one(json_file) # Insert simulation in Mongo

                            return Response(json_simulation) # Return simulation results
              </xmp>
            </div>
          </section>
        </section>
        <!-- Link2 Ends -->

        <!-- Link3 start -->
        <section id="link3">
          <div class="h-full mt-5">
            <p class="font-normal text-2xl">Julia Model</p>
            <br>
            <p class="leading-0 w-3/4">
              The Julia model is running on the Django and Nginx server. A server with an API has been implemented in Julia
              to receive simulation requests. The server only serves requests locally, so it is not exposed to the internet.
            </p>
          </div>
        </section>
        <section id="link3_1" class="border-l-[2px]">
            <div class="h-full mt-5 ml-5">
              <p class="font-normal text-xl">Julia API server</p>
              <p class="text-sm pb-4">
                  The model takes between 30-60 secs to generate the simulation. In order to accelerate the requests,
                  the server has a cache system. The system stores the simulation generated by the users in a Mongo database.
                  Each simulation has a unique ID to identify them. The ID is obtained through the JSON file generated
                  by the GET request using MD5. The server checks if the ID exists, if it exists,
                  the database is accessed and the simulation is returned, otherwise the model is called.
              </p>
              <xmp>
                # "service" functions to actually do the work
                function simulation_post(req::HTTP.Request)
                    params = JSON.parse(IOBuffer(HTTP.payload(req)))
                    simulation = generate_simulation(params)
                    return HTTP.Response(200, JSON2.write(JSON.json(simulation)))
                end


                # define REST endpoints to dispatch to "service" functions
                const SIMULATION_ROUTER = HTTP.Router()
                HTTP.@register(SIMULATION_ROUTER, "POST", "/simulation", simulation_post)

                HTTP.serve(SIMULATION_ROUTER, Sockets.localhost, 8081)
              </xmp>
            </div>
        </section>

        <section id="link3_2" class="border-l-[2px]">
            <div class="h-full mt-5 ml-5">
              <p class="font-normal text-xl">Julia Model MMCAcovid19.jl</p>
              <p class="text-sm pb-4">
                  The implementation of the model can be consulted here <a href="https://github.com/jtmatamalas/MMCAcovid19.jl" target="_blank" class="bg-gray-300 text-slate-700 rounded p-1 hover:text-pink-400">MMCAcovid19</a>.<br><br>
                  The documentation of the model can be found here <a href="https://jtmatamalas.github.io/MMCAcovid19.jl/v0.1/" target="_blank" class="bg-gray-300 text-slate-700 rounded p-1 hover:text-pink-400">MMCAcovid19 Documentation</a>.
              </p>
            </div>
        </section>
        <!-- Link3 end -->



      </div>
    </div>
    <!-- Footer starts here -->
    <footer>
      <div class="dark:bg-white bg-slate-900 h-38 py-1 px-1 mt-5">
        <div
          tabindex="0"
          aria-label="footer"
          class="focus:outline-none mx-auto container flex flex-col items-center justify-center"
        >
          <div class="text-black flex flex-col md:items-center f-f-l pt-0">
            <div class="my-6 text-base text-color f-f-l">
              <ul class="md:flex items-center">
                <li class="md:mr-6 cursor-pointer pt-4 lg:py-0">
                  <a
                    href="./index.html"
                    class="text-white dark:text-black focus:outline-none focus:underline hover:text-gray-200"
                    >Home
                  </a>
                </li>
                <li class="md:mr-6 cursor-pointer pt-4 lg:py-0">
                </li>
              </ul>
            </div>
            <div class="text-sm text-color mb-10 f-f-l">
              <!-- Rename cleandocs with your respective name -->
              <p tabindex="0" class="text-white dark:text-black focus:outline-none">
                &copy; 2022 Alephsyslab
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
    <!-- Footer ends here -->
  </body>
</html>